# ====================================================================
# .htaccess для ЧПУ (Человеко-Понятных URL)
# ====================================================================

# Включаем mod_rewrite
RewriteEngine On
RewriteBase /

# Принудительное использование UTF-8
AddDefaultCharset UTF-8

# ====================================================================
# ЧПУ для проектов: /projects/slug
# ====================================================================

# Список всех проектов: /projects или /projects/
RewriteRule ^projects/?$ projects.php [L,QSA]

# Отдельный проект: /projects/trezvaya-rossiya
RewriteRule ^projects/([a-zA-Z0-9\-]+)/?$ project.php?slug=$1 [L,QSA]

# ====================================================================
# ЧПУ для новостей: /news/slug
# ====================================================================

# Список всех новостей: /news или /news/
RewriteRule ^news/?$ news.php [L,QSA]

# Отдельная новость: /news/itogi-2024-goda
RewriteRule ^news/([a-zA-Z0-9\-]+)/?$ news-single.php?slug=$1 [L,QSA]






# ====================================================================
# Другие страницы
# ====================================================================

# О фонде
RewriteRule ^about/?$ about.php [L]

# Контакты
RewriteRule ^contacts/?$ contacts.php [L]

#Документы
RewriteRule ^documents/?$ documents.php [L]

# Партнёры
RewriteRule ^partners/?$ partners.php [L]

# Как помочь
RewriteRule ^donate/?$ donate.php [L]

# ====================================================================
# Безопасность
# ====================================================================

# Запрет доступа к служебным файлам
<FilesMatch "^(\.htaccess|\.htpasswd|\.env|composer\.json|composer\.lock)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Запрет доступа к директории includes
RewriteRule ^includes/ - [F,L]

# Запрет доступа к content (файлы markdown)
RewriteRule ^content/ - [F,L]

# ====================================================================
# Кеширование статических файлов
# ====================================================================

<IfModule mod_expires.c>
    ExpiresActive On
    
    # Изображения
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    
    # CSS и JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    
    # Шрифты
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
</IfModule>

# ====================================================================
# Сжатие GZIP
# ====================================================================

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ====================================================================
# Безопасность HTTP заголовков
# ====================================================================

<IfModule mod_headers.c>
    # Защита от XSS
    Header set X-XSS-Protection "1; mode=block"
    
    # Запрет встраивания в iframe (кроме своего домена)
    Header set X-Frame-Options "SAMEORIGIN"
    
    # Блокировка определения типа контента браузером
    Header set X-Content-Type-Options "nosniff"
    
    # Referrer Policy
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# ====================================================================
# Обработка ошибок
# ====================================================================

# Кастомные страницы ошибок
ErrorDocument 404 /404.php
ErrorDocument 403 /403.php
ErrorDocument 500 /500.php